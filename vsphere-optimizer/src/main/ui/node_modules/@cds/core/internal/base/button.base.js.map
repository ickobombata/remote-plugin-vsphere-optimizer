{"version":3,"file":"button.base.js","sources":["../../../../src/internal/base/button.base.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2022 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { __decorate } from \"tslib\";\nimport { html, LitElement, render } from 'lit';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { property, state } from '../decorators/property.js';\nimport { querySlot } from '../decorators/query-slot.js';\nimport { onAnyKey } from '../utils/keycodes.js';\nimport { stopEvent } from './../utils/events.js';\n// @dynamic\nexport class CdsBaseButton extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.readonly = false;\n        this.disabled = false;\n        this.focused = false;\n        this.active = false;\n        this.isAnchor = false;\n        // When submitting forms with Enter key, the default submit button receives a click event from the form.\n        // We need to be able to differentiate between the real/explicit clicks and those form produced clicks.\n        // Otherwise we will submit the form twice.\n        this.explicitClick = false;\n        this.markerSignificantProperties = ['type', 'name', 'value', 'disabled'];\n    }\n    render() {\n        return html ` <slot></slot> `;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.tabIndex = 0; // initialize immediately so button can be focused synchronously\n        this.role = 'button';\n    }\n    updated(props) {\n        if (this.hasMarkerSignificantProperty(props)) {\n            if (this.markerAttached) {\n                this.marker.remove();\n            }\n            this.createMarker();\n        }\n        super.updated(props);\n        this.updateButtonAttributes();\n        this.addDefaultSubmitBehavior();\n        if (props.has('readonly')) {\n            this.setupNativeButtonBehavior();\n        }\n    }\n    /** This mimics the mouse-click visual behavior for keyboard only users and screen readers.\n     * Browsers do not apply the CSS psuedo-selector :active in those instances. So we need this\n     * for our :active styles to show.\n     *\n     * Make sure to update a component's CSS to account for the presence of the [_active] attribute\n     * in all instance where :active is defined.\n     *\n     * @private\n     */\n    emulateActiveMouseDown() {\n        if (!this.disabled && !this.readonly) {\n            this.active = true;\n        }\n    }\n    emulateActiveMouseUp() {\n        this.active = false;\n        this.explicitClick = true; // mouse down/up are only associated with real clicks\n    }\n    setupNativeButtonBehavior() {\n        if (this.readonly) {\n            this.removeEventListener('keyup', this.emulateActiveMouseUp);\n            this.removeEventListener('keydown', this.emulateActiveMouseDown);\n            this.removeEventListener('mouseup', this.emulateActiveMouseUp);\n            this.removeEventListener('mousedown', this.emulateActiveMouseDown);\n            this.removeEventListener('click', this.triggerNativeButtonBehavior);\n            this.removeEventListener('keyup', this.emulateKeyBoardEventBehavior);\n        }\n        else {\n            this.addEventListener('keyup', this.emulateActiveMouseUp);\n            this.addEventListener('keydown', this.emulateActiveMouseDown);\n            this.addEventListener('mouseup', this.emulateActiveMouseUp);\n            this.addEventListener('mousedown', this.emulateActiveMouseDown);\n            this.addEventListener('click', this.triggerNativeButtonBehavior);\n            this.addEventListener('keyup', this.emulateKeyBoardEventBehavior);\n        }\n    }\n    /**\n     * We have to append a hidden button outside the web component in the light DOM\n     * This allows us to trigger native submit events within a form element.\n     */\n    triggerNativeButtonBehavior(event) {\n        var _a;\n        if (!this.readonly) {\n            if (this.disabled) {\n                stopEvent(event);\n            }\n            else if (!event.defaultPrevented && this.marker && this.explicitClick) {\n                if (!this.markerAttached) {\n                    this.appendChild(this.marker);\n                }\n                (_a = this.querySelector('button[aria-hidden]')) === null || _a === void 0 ? void 0 : _a.dispatchEvent(new MouseEvent('click', { relatedTarget: this, composed: true }));\n                if (this.type !== 'submit') {\n                    this.marker.remove();\n                }\n            }\n        }\n        // get ready for the next real click check\n        this.explicitClick = false;\n    }\n    createMarker() {\n        const buttonTemplate = html `<button\n      aria-hidden=\"true\"\n      role=\"presentation\"\n      ?disabled=\"${this.disabled}\"\n      tabindex=\"-1\"\n      style=\"display: none !important\"\n      value=\"${ifDefined(this.value)}\"\n      name=\"${ifDefined(this.name)}\"\n      type=\"${ifDefined(this.type)}\"\n    ></button>`;\n        const marker = document.createElement('div');\n        // avoid an empty space inside button\n        marker.style.display = 'none';\n        render(buttonTemplate, marker);\n        this.marker = marker;\n    }\n    get markerAttached() {\n        return !!(this.marker && this.marker.parentElement);\n    }\n    // A marker significant property is one that should be dynamically bound to a property of the native button\n    hasMarkerSignificantProperty(props) {\n        for (const prop of this.markerSignificantProperties) {\n            if (props.has(prop)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    emulateKeyBoardEventBehavior(evt) {\n        onAnyKey(['enter', 'space'], evt, () => {\n            if (!this.readonly) {\n                this.click();\n                stopEvent(evt);\n            }\n        });\n    }\n    updateButtonAttributes() {\n        var _a;\n        this.isAnchor = ((_a = this.parentElement) === null || _a === void 0 ? void 0 : _a.tagName) === 'A';\n        if (this.isAnchor && this.parentElement) {\n            this.parentElement.style.lineHeight = '0';\n            this.parentElement.style.textDecoration = 'none'; // fixes issue when style is applied to text node\n        }\n        this.readonly = this.readonly || this.isAnchor;\n        if (this.readonly) {\n            this.role = null;\n            this.tabIndexAttr = null;\n            this.ariaDisabled = null;\n        }\n        else {\n            this.role = 'button';\n            this.tabIndexAttr = this.disabled ? -1 : 0;\n            this.ariaDisabled = this.disabled ? 'true' : 'false';\n        }\n    }\n    // Forms handle default submit buttons without type=\"submit\" automatically.\n    // Because of the dynamic createion of the native element, we prefer to set the attribute explicitly.\n    addDefaultSubmitBehavior() {\n        if (!this.type && this.closest('form')) {\n            this.type = 'submit';\n        }\n        if (this.type === 'submit' && !this.markerAttached) {\n            this.appendChild(this.marker);\n        }\n    }\n}\n__decorate([\n    property({ type: Boolean })\n], CdsBaseButton.prototype, \"readonly\", void 0);\n__decorate([\n    property({ type: String })\n], CdsBaseButton.prototype, \"type\", void 0);\n__decorate([\n    property({ type: String })\n], CdsBaseButton.prototype, \"name\", void 0);\n__decorate([\n    property({ type: String })\n], CdsBaseButton.prototype, \"value\", void 0);\n__decorate([\n    property({ type: Boolean })\n], CdsBaseButton.prototype, \"disabled\", void 0);\n__decorate([\n    state({ type: Number, attribute: 'tabindex', reflect: true })\n], CdsBaseButton.prototype, \"tabIndexAttr\", void 0);\n__decorate([\n    state({ type: Boolean, reflect: true })\n], CdsBaseButton.prototype, \"focused\", void 0);\n__decorate([\n    state({ type: Boolean, reflect: true })\n], CdsBaseButton.prototype, \"active\", void 0);\n__decorate([\n    state({ type: Boolean, reflect: true })\n], CdsBaseButton.prototype, \"isAnchor\", void 0);\n__decorate([\n    querySlot('cds-icon')\n], CdsBaseButton.prototype, \"icon\", void 0);\n__decorate([\n    querySlot('cds-badge')\n], CdsBaseButton.prototype, \"badge\", void 0);\n"],"names":["CdsBaseButton","LitElement","constructor","super","this","readonly","disabled","focused","active","isAnchor","explicitClick","markerSignificantProperties","render","html","connectedCallback","tabIndex","role","updated","props","hasMarkerSignificantProperty","markerAttached","marker","remove","createMarker","updateButtonAttributes","addDefaultSubmitBehavior","has","setupNativeButtonBehavior","emulateActiveMouseDown","emulateActiveMouseUp","removeEventListener","triggerNativeButtonBehavior","emulateKeyBoardEventBehavior","addEventListener","event","_a","stopEvent","defaultPrevented","appendChild","querySelector","dispatchEvent","MouseEvent","relatedTarget","composed","type","buttonTemplate","ifDefined","value","name","document","createElement","style","display","parentElement","prop","evt","onAnyKey","click","tagName","lineHeight","textDecoration","tabIndexAttr","ariaDisabled","closest","__decorate","property","Boolean","prototype","String","state","Number","attribute","reflect","querySlot"],"mappings":"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"}