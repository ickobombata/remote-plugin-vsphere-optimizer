import{FocusTrapTrackerService as e}from"../services/focus-trap-tracker.service.js";import{isFocusable as t,isHTMLElement as o}from"./dom.js";import{createId as n}from"./identity.js";function s(t,o,n){const s=e.getCurrent()===o,i=r(t,o);s&&i?(n=n||o).focus():t.focus()}function r(e,t){return e===t.topReboundElement||e===t.bottomReboundElement||!(t.contains(e)||null!==t.shadowRoot&&t.shadowRoot.contains(e))}function i(){const e=document.createElement("span");return e.setAttribute("tabindex","0"),e.classList.add("offscreen-focus-rebounder"),e}function u(e){if(e&&!e.topReboundElement&&!e.bottomReboundElement){e.topReboundElement=i(),e.bottomReboundElement=i();const t=e.parentElement,o=e.nextSibling;t&&(t.insertBefore(e.topReboundElement,e),o?t.insertBefore(e.bottomReboundElement,o):t.appendChild(e.bottomReboundElement))}}function c(e){if(e){const t=e.parentElement;if(t){const o=e.topReboundElement,n=e.bottomReboundElement;o&&t.removeChild(o),n&&t.removeChild(n)}delete e.topReboundElement,delete e.bottomReboundElement}}function m(e){return e}class a{constructor(e){this.active=!1,(e=e).focusTrapId||(e.focusTrapId=n()),this.focusTrapElement=e}enableFocusTrap(){const n=this.focusTrapElement,s=n.querySelector("[cds-first-focus]"),r=n.shadowRoot?n.shadowRoot.querySelector(".private-host[tabindex]"):null,i=document.activeElement;if(e.getCurrent()===n)throw Error("Focus trap is already enabled for this instance.");this.firstFocusElement=s||r||this.focusTrapElement,u(n),t(n)||n.setAttribute("tabindex","-1"),i&&o(i)&&(this.previousFocus=i),e.setCurrent(n);const c=setTimeout((()=>{this.firstFocusElement.focus(),clearTimeout(c)}),10);this.onFocusInEvent=this.onFocusIn.bind(this),document.addEventListener("focusin",this.onFocusInEvent),this.active=!0}removeFocusTrap(){document.removeEventListener("focusin",this.onFocusInEvent),c(this.focusTrapElement),e.activatePreviousCurrent(),this.active=!1,this.previousFocus&&this.previousFocus.focus()}onFocusIn(e){s(e.composedPath()[0],this.focusTrapElement,this.firstFocusElement)}}export{a as FocusTrap,u as addReboundElementsToFocusTrapElement,m as castHtmlElementToFocusTrapElement,i as createFocusTrapReboundElement,r as elementIsOutsideFocusTrapElement,s as refocusIfOutsideFocusTrapElement,c as removeReboundElementsFromFocusTrapElement};
//# sourceMappingURL=focus-trap.js.map
