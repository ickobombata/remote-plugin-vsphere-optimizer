import{__decorate as e}from"tslib";import{FocusTrapTrackerService as t,CdsBaseFocusTrap as r,onKey as o,createId as s,baseStyles as i,property as a,event as d,state as n,animate as c,reverseAnimation as p,AnimationModalEnterName as l}from"@cds/core/internal";import{html as v}from"lit";import{query as h}from"lit/decorators/query.js";import u from"./overlay.element.scss.js";function y(e,t,r,o){const s=r.filter((e=>e.indexOf(t)>-1));return!0===o&&r.indexOf(e)<0||s.indexOf(e)>0}function f(e,r=t){var o;return(null===(o=r.getCurrent())||void 0===o?void 0:o.focusTrapId)===e}let k=class extends r{constructor(){super();this.cdsMotion="on",this.overlayIdPrefix="_overlay-",this.isLayered=!1,this.fireEventOnBackdropClick=()=>{f(this.focusTrapId)&&this.closeOverlay("backdrop-click")},this.fireEventOnEscape=e=>{f(this.focusTrapId)&&o("escape",e,(()=>{this.closeOverlay("escape-keypress")}))},this.focusTrapId=s(this.overlayIdPrefix)}static get shadowRootOptions(){return{...super.shadowRootOptions,delegatesFocus:!0}}firstUpdated(e){super.firstUpdated(e),this.backdrop.addEventListener("click",this.fireEventOnBackdropClick)}updated(e){super.updated(e);const r=this.isLayered,o=y(this.focusTrapId,this.overlayIdPrefix,t.getTrapElements().map((e=>e.focusTrapId)),r);r!==o&&(this.isLayered=o,this.requestUpdate("isLayered",r))}connectedCallback(){super.connectedCallback(),this.ariaModal="true",this.role="dialog",window.addEventListener("keydown",this.fireEventOnEscape)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("keydown",this.fireEventOnEscape),this.backdrop.removeEventListener("click",this.fireEventOnBackdropClick)}closeOverlay(e="custom"){this.closeChange.emit(e)}get backdropTemplate(){return v`<div class="${this.isLayered?"overlay-backdrop layered":"overlay-backdrop"}" aria-hidden="true"></div>`}render(){return v`${this.backdropTemplate}<div class="private-host" tabindex="-1" aria-modal="true" role="dialog"><slot></slot></div>`}static get styles(){return[i,u]}};e([a({type:String})],k.prototype,"cdsMotion",void 0),e([d()],k.prototype,"cdsMotionChange",void 0),e([d()],k.prototype,"closeChange",void 0),e([n({type:Boolean})],k.prototype,"isLayered",void 0),e([h(".overlay-backdrop")],k.prototype,"backdrop",void 0),k=e([c({hidden:{true:p(l),false:l}})],k);export{k as CdsInternalOverlay,y as isNestedOverlay,f as overlayIsActive};
//# sourceMappingURL=overlay.element.js.map
